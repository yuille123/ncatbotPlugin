import{j as r,al as Sr,i as Me,d as cr,a2 as je,a3 as Oe,a4 as xe,b as Y,g as lr,c as _r,a as ur,am as yr,an as br,ao as jr,ap as Or,aq as xr,ar as Er,u as Ir,k as Nr}from"./index-CccuTvbI.js";import{i as Re}from"./chunk-2QAN2V2R-scuJRJyz.js";import{r as I}from"./react-router-dom-BuK5Vxqh.js";import{V as X}from"./react-hot-toast-LXUdLeap.js";import{g as wr,a as Tr,q as kr,i as De,O as M,b as Cr,c as Mr,d as Rr,s as dr,e as Dr,f as le,C as Pr,h as Ar}from"./modal-DXYgRyQ0.js";import{f as Lr}from"./index-BW41MP6H.js";import{c as W}from"./chunk-NAV3ZXLI-Cu9UHLmN.js";import{t as Wr}from"./time-BWkNlFcH.js";import{a as _e}from"./chunk-SXMLSBOY-CQ3-m1Kj.js";import{m as Ur}from"./proxy-C_FjiHIC.js";import{C as qr}from"./code_editor-BOlRgJWM.js";import{g as fr,r as Ee,a as Fr}from"./react-dom-DoC2WAmd.js";import{a as zr}from"./isPlainObject-Da9j-YLi.js";import{u as Gr,e as Hr}from"./index-CYXW7ZCx.js";import{s as Br}from"./chunk-KVDW62ZT-DxEdsCLi.js";import{l as $r}from"./chunk-O4OUNAUT-DXD-aBc7.js";import"./monaco-editor-D-sLb42b.js";import"./react-icons-FgIH09Ic.js";import"./chunk-SLABUSGS-BMvBJEIh.js";import"./_baseIsEqual-C27Ppj04.js";import"./use-dialog-B_ajw9ye.js";import"./index-DQn0RI8C.js";import"./url-ByheBKOA.js";import"./index-CrlUKyvM.js";import"./qface-Cs62R3Iw.js";import"./chunk-ML27DD5T-YcpzojV6.js";import"./index-CokAva9Y.js";import"./openLink-DRU7_5Wb.js";import"./useListState-YM5D1-iN.js";import"./usePress-3YWMO_Ik.js";import"./SelectionManager-FvVuIllO.js";import"./features-animation-CVX41PUG.js";import"./react-hook-form-D0lfHpL7.js";function ye(){return ye=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},ye.apply(null,arguments)}var Jr=zr();const Vr=fr(Jr);var Pe=new WeakMap,Ae=new WeakMap;function vr(e,t){var a=Pe.get(e);if(a)return a;if(Ae.has(e))return e;var n=new Proxy(e,{get:function(i,v,p){var g=Reflect.get(i,v,p),h=Reflect.getOwnPropertyDescriptor(i,v);return!(h!=null&&h.configurable)&&!(h!=null&&h.writable)?g:Vr(g)||Array.isArray(g)?vr(g,t):g},set:function(i,v,p){var g=Reflect.set(i,v,p);return t(),g},deleteProperty:function(i,v){var p=Reflect.deleteProperty(i,v);return t(),p}});return Pe.set(e,n),Ae.set(n,e),n}function Kr(e){var t=Gr(),a=I.useRef(e),n=Hr(function(){return vr(a.current,function(){t()})},[]);return n}function Le(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function be(e,t){return be=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,n){return a.__proto__=n,a},be(e,t)}function Qr(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,be(e,t)}var We=Number.isNaN||function(t){return typeof t=="number"&&t!==t};function Yr(e,t){return!!(e===t||We(e)&&We(t))}function Xr(e,t){if(e.length!==t.length)return!1;for(var a=0;a<e.length;a++)if(!Yr(e[a],t[a]))return!1;return!0}function fe(e,t){t===void 0&&(t=Xr);var a,n=[],i,v=!1;function p(){for(var g=[],h=0;h<arguments.length;h++)g[h]=arguments[h];return v&&a===this&&t(g,n)||(i=e.apply(this,g),v=!0,a=this,n=g),i}return p}var Zr=typeof performance=="object"&&typeof performance.now=="function",Ue=Zr?function(){return performance.now()}:function(){return Date.now()};function qe(e){cancelAnimationFrame(e.id)}function et(e,t){var a=Ue();function n(){Ue()-a>=t?e.call(null):i.id=requestAnimationFrame(n)}var i={id:requestAnimationFrame(n)};return i}var ve=-1;function Fe(e){if(e===void 0&&(e=!1),ve===-1||e){var t=document.createElement("div"),a=t.style;a.width="50px",a.height="50px",a.overflow="scroll",document.body.appendChild(t),ve=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return ve}var V=null;function ze(e){if(e===void 0&&(e=!1),V===null||e){var t=document.createElement("div"),a=t.style;a.width="50px",a.height="50px",a.overflow="scroll",a.direction="rtl";var n=document.createElement("div"),i=n.style;return i.width="100px",i.height="100px",t.appendChild(n),document.body.appendChild(t),t.scrollLeft>0?V="positive-descending":(t.scrollLeft=1,t.scrollLeft===0?V="negative":V="positive-ascending"),document.body.removeChild(t),V}return V}var rt=150,tt=function(t,a){return t};function nt(e){var t,a=e.getItemOffset,n=e.getEstimatedTotalSize,i=e.getItemSize,v=e.getOffsetForIndexAndAlignment,p=e.getStartIndexForOffset,g=e.getStopIndexForStartIndex,h=e.initInstanceProps,S=e.shouldResetStyleCacheOnItemSizeChange,d=e.validateProps;return t=function(u){Qr(m,u);function m(c){var s;return s=u.call(this,c)||this,s._instanceProps=h(s.props,Le(s)),s._outerRef=void 0,s._resetIsScrollingTimeoutId=null,s.state={instance:Le(s),isScrolling:!1,scrollDirection:"forward",scrollOffset:typeof s.props.initialScrollOffset=="number"?s.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},s._callOnItemsRendered=void 0,s._callOnItemsRendered=fe(function(f,l,_,b){return s.props.onItemsRendered({overscanStartIndex:f,overscanStopIndex:l,visibleStartIndex:_,visibleStopIndex:b})}),s._callOnScroll=void 0,s._callOnScroll=fe(function(f,l,_){return s.props.onScroll({scrollDirection:f,scrollOffset:l,scrollUpdateWasRequested:_})}),s._getItemStyle=void 0,s._getItemStyle=function(f){var l=s.props,_=l.direction,b=l.itemSize,x=l.layout,y=s._getItemStyleCache(S&&b,S&&x,S&&_),j;if(y.hasOwnProperty(f))j=y[f];else{var O=a(s.props,f,s._instanceProps),w=i(s.props,f,s._instanceProps),k=_==="horizontal"||x==="horizontal",J=_==="rtl",z=k?O:0;y[f]=j={position:"absolute",left:J?void 0:z,right:J?z:void 0,top:k?0:O,height:k?"100%":w,width:k?w:"100%"}}return j},s._getItemStyleCache=void 0,s._getItemStyleCache=fe(function(f,l,_){return{}}),s._onScrollHorizontal=function(f){var l=f.currentTarget,_=l.clientWidth,b=l.scrollLeft,x=l.scrollWidth;s.setState(function(y){if(y.scrollOffset===b)return null;var j=s.props.direction,O=b;if(j==="rtl")switch(ze()){case"negative":O=-b;break;case"positive-descending":O=x-_-b;break}return O=Math.max(0,Math.min(O,x-_)),{isScrolling:!0,scrollDirection:y.scrollOffset<O?"forward":"backward",scrollOffset:O,scrollUpdateWasRequested:!1}},s._resetIsScrollingDebounced)},s._onScrollVertical=function(f){var l=f.currentTarget,_=l.clientHeight,b=l.scrollHeight,x=l.scrollTop;s.setState(function(y){if(y.scrollOffset===x)return null;var j=Math.max(0,Math.min(x,b-_));return{isScrolling:!0,scrollDirection:y.scrollOffset<j?"forward":"backward",scrollOffset:j,scrollUpdateWasRequested:!1}},s._resetIsScrollingDebounced)},s._outerRefSetter=function(f){var l=s.props.outerRef;s._outerRef=f,typeof l=="function"?l(f):l!=null&&typeof l=="object"&&l.hasOwnProperty("current")&&(l.current=f)},s._resetIsScrollingDebounced=function(){s._resetIsScrollingTimeoutId!==null&&qe(s._resetIsScrollingTimeoutId),s._resetIsScrollingTimeoutId=et(s._resetIsScrolling,rt)},s._resetIsScrolling=function(){s._resetIsScrollingTimeoutId=null,s.setState({isScrolling:!1},function(){s._getItemStyleCache(-1,null)})},s}m.getDerivedStateFromProps=function(s,f){return at(s,f),d(s),null};var o=m.prototype;return o.scrollTo=function(s){s=Math.max(0,s),this.setState(function(f){return f.scrollOffset===s?null:{scrollDirection:f.scrollOffset<s?"forward":"backward",scrollOffset:s,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},o.scrollToItem=function(s,f){f===void 0&&(f="auto");var l=this.props,_=l.itemCount,b=l.layout,x=this.state.scrollOffset;s=Math.max(0,Math.min(s,_-1));var y=0;if(this._outerRef){var j=this._outerRef;b==="vertical"?y=j.scrollWidth>j.clientWidth?Fe():0:y=j.scrollHeight>j.clientHeight?Fe():0}this.scrollTo(v(this.props,s,f,x,this._instanceProps,y))},o.componentDidMount=function(){var s=this.props,f=s.direction,l=s.initialScrollOffset,_=s.layout;if(typeof l=="number"&&this._outerRef!=null){var b=this._outerRef;f==="horizontal"||_==="horizontal"?b.scrollLeft=l:b.scrollTop=l}this._callPropsCallbacks()},o.componentDidUpdate=function(){var s=this.props,f=s.direction,l=s.layout,_=this.state,b=_.scrollOffset,x=_.scrollUpdateWasRequested;if(x&&this._outerRef!=null){var y=this._outerRef;if(f==="horizontal"||l==="horizontal")if(f==="rtl")switch(ze()){case"negative":y.scrollLeft=-b;break;case"positive-ascending":y.scrollLeft=b;break;default:var j=y.clientWidth,O=y.scrollWidth;y.scrollLeft=O-j-b;break}else y.scrollLeft=b;else y.scrollTop=b}this._callPropsCallbacks()},o.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&qe(this._resetIsScrollingTimeoutId)},o.render=function(){var s=this.props,f=s.children,l=s.className,_=s.direction,b=s.height,x=s.innerRef,y=s.innerElementType,j=s.innerTagName,O=s.itemCount,w=s.itemData,k=s.itemKey,J=k===void 0?tt:k,z=s.layout,D=s.outerElementType,U=s.outerTagName,Z=s.style,ue=s.useIsScrolling,q=s.width,se=this.state.isScrolling,ee=_==="horizontal"||z==="horizontal",E=ee?this._onScrollHorizontal:this._onScrollVertical,N=this._getRangeToRender(),F=N[0],ie=N[1],G=[];if(O>0)for(var C=F;C<=ie;C++)G.push(I.createElement(f,{data:w,key:J(C,w),index:C,isScrolling:ue?se:void 0,style:this._getItemStyle(C)}));var re=n(this.props,this._instanceProps);return I.createElement(D||U||"div",{className:l,onScroll:E,ref:this._outerRefSetter,style:ye({position:"relative",height:b,width:q,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:_},Z)},I.createElement(y||j||"div",{children:G,ref:x,style:{height:ee?"100%":re,pointerEvents:se?"none":void 0,width:ee?re:"100%"}}))},o._callPropsCallbacks=function(){if(typeof this.props.onItemsRendered=="function"){var s=this.props.itemCount;if(s>0){var f=this._getRangeToRender(),l=f[0],_=f[1],b=f[2],x=f[3];this._callOnItemsRendered(l,_,b,x)}}if(typeof this.props.onScroll=="function"){var y=this.state,j=y.scrollDirection,O=y.scrollOffset,w=y.scrollUpdateWasRequested;this._callOnScroll(j,O,w)}},o._getRangeToRender=function(){var s=this.props,f=s.itemCount,l=s.overscanCount,_=this.state,b=_.isScrolling,x=_.scrollDirection,y=_.scrollOffset;if(f===0)return[0,0,0,0];var j=p(this.props,y,this._instanceProps),O=g(this.props,j,y,this._instanceProps),w=!b||x==="backward"?Math.max(1,l):1,k=!b||x==="forward"?Math.max(1,l):1;return[Math.max(0,j-w),Math.max(0,Math.min(f-1,O+k)),j,O]},m}(I.PureComponent),t.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},t}var at=function(t,a){t.children,t.direction,t.height,t.layout,t.innerTagName,t.outerTagName,t.width,a.instance},st=50,K=function(t,a,n){var i=t,v=i.itemSize,p=n.itemMetadataMap,g=n.lastMeasuredIndex;if(a>g){var h=0;if(g>=0){var S=p[g];h=S.offset+S.size}for(var d=g+1;d<=a;d++){var u=v(d);p[d]={offset:h,size:u},h+=u}n.lastMeasuredIndex=a}return p[a]},it=function(t,a,n){var i=a.itemMetadataMap,v=a.lastMeasuredIndex,p=v>0?i[v].offset:0;return p>=n?hr(t,a,v,0,n):ot(t,a,Math.max(0,v),n)},hr=function(t,a,n,i,v){for(;i<=n;){var p=i+Math.floor((n-i)/2),g=K(t,p,a).offset;if(g===v)return p;g<v?i=p+1:g>v&&(n=p-1)}return i>0?i-1:0},ot=function(t,a,n,i){for(var v=t.itemCount,p=1;n<v&&K(t,n,a).offset<i;)n+=p,p*=2;return hr(t,a,Math.min(n,v-1),Math.floor(n/2),i)},Ge=function(t,a){var n=t.itemCount,i=a.itemMetadataMap,v=a.estimatedItemSize,p=a.lastMeasuredIndex,g=0;if(p>=n&&(p=n-1),p>=0){var h=i[p];g=h.offset+h.size}var S=n-p-1,d=S*v;return g+d},ct=nt({getItemOffset:function(t,a,n){return K(t,a,n).offset},getItemSize:function(t,a,n){return n.itemMetadataMap[a].size},getEstimatedTotalSize:Ge,getOffsetForIndexAndAlignment:function(t,a,n,i,v,p){var g=t.direction,h=t.height,S=t.layout,d=t.width,u=g==="horizontal"||S==="horizontal",m=u?d:h,o=K(t,a,v),c=Ge(t,v),s=Math.max(0,Math.min(c-m,o.offset)),f=Math.max(0,o.offset-m+o.size+p);switch(n==="smart"&&(i>=f-m&&i<=s+m?n="auto":n="center"),n){case"start":return s;case"end":return f;case"center":return Math.round(f+(s-f)/2);case"auto":default:return i>=f&&i<=s?i:i<f?f:s}},getStartIndexForOffset:function(t,a,n){return it(t,n,a)},getStopIndexForStartIndex:function(t,a,n,i){for(var v=t.direction,p=t.height,g=t.itemCount,h=t.layout,S=t.width,d=v==="horizontal"||h==="horizontal",u=d?S:p,m=K(t,a,i),o=n+u,c=m.offset+m.size,s=a;s<g-1&&c<o;)s++,c+=K(t,s,i).size;return s},initInstanceProps:function(t,a){var n=t,i=n.estimatedItemSize,v={itemMetadataMap:{},estimatedItemSize:i||st,lastMeasuredIndex:-1};return a.resetAfterIndex=function(p,g){g===void 0&&(g=!0),v.lastMeasuredIndex=Math.min(v.lastMeasuredIndex,p-1),a._getItemStyleCache(-1),g&&a.forceUpdate()},v},shouldResetStyleCacheOnItemSizeChange:!1,validateProps:function(t){t.itemSize}});const lt=({data:e})=>r.jsxs("div",{className:"flex gap-2",children:[r.jsx(W,{children:"心跳"}),r.jsxs(W,{children:["间隔 ",e.status.interval,"ms"]})]}),ut=({data:e})=>r.jsxs("div",{className:"flex gap-2",children:[r.jsx(W,{children:"生命周期"}),r.jsx(W,{color:Tr(e.sub_type),children:wr(e.sub_type)})]}),dt=({data:e})=>r.jsxs("div",{className:"h-full flex items-center",children:[e.meta_event_type==="lifecycle"&&r.jsx(ut,{data:e}),e.meta_event_type==="heartbeat"&&r.jsx(lt,{data:e})]}),He=(e,t=!1)=>e.map((a,n)=>{switch(a.type){case"text":return r.jsx("span",{children:a.data.text},n);case"face":return r.jsx(Me,{removeWrapper:!0,classNames:{img:"w-6 h-6 inline !text-[0px] m-0 -mt-1.5 !p-0"},src:kr.getUrl(a.data.id),alt:`face-${a.data.id}`},n);case"image":return r.jsx(Me,{classNames:{wrapper:"block !text-[0px] !m-0 !p-0",img:"block"},radius:"sm",className:t?"max-h-16 object-cover":"max-w-64 max-h-96 h-auto object-cover",src:a.data.url||a.data.file,alt:"image",referrerPolicy:"no-referrer"},n);case"record":return r.jsx("audio",{controls:!0,src:a.data.url||a.data.file},n);case"video":return r.jsx("video",{controls:!0,src:a.data.url||a.data.file},n);case"at":return r.jsxs("span",{className:"text-blue-500",children:["@",a.data.qq==="all"?"所有人":r.jsxs("span",{children:[a.data.name,"(",a.data.qq,")"]})]},n);case"rps":return r.jsx("span",{children:"[猜拳]"},n);case"dice":return r.jsx("span",{children:"[掷骰子]"},n);case"shake":return r.jsx("span",{children:"[窗口抖动]"},n);case"poke":return r.jsxs("span",{children:["[戳一戳: ",a.data.name||a.data.id,"]"]},n);case"anonymous":return r.jsx("span",{children:"[匿名消息]"},n);case"share":return r.jsx("a",{href:a.data.url,target:"_blank",rel:"noopener noreferrer",children:a.data.title},n);case"contact":return r.jsxs("span",{children:["[推荐",a.data.type==="qq"?"好友":"群",": ",a.data.id,"]"]},n);case"location":return r.jsxs("span",{children:["[位置: ",a.data.title||"未知","]"]},n);case"music":return a.data.type==="custom"?r.jsx("a",{href:a.data.url,target:"_blank",rel:"noopener noreferrer",children:a.data.title},n):r.jsxs("span",{children:["[音乐: ",a.data.type," - ",a.data.id,"]"]},n);case"reply":return r.jsxs("div",{className:"bg-content3 py-1 px-2 rounded-md flex items-center gap-1",children:[r.jsx(Sr,{className:"text-default-500"}),"回复消息ID: ",a.data.id]},n);case"forward":return r.jsxs("span",{children:["[合并转发: ",a.data.id,"]"]},n);case"node":return r.jsx("span",{children:"[消息节点]"},n);case"xml":return r.jsx("pre",{children:a.data.data},n);case"json":return r.jsx("pre",{className:"break-all whitespace-break-spaces",children:a.data.data},n);case"file":return r.jsx("a",{href:a.data.file,target:"_blank",rel:"noopener noreferrer",children:"[文件]"},n);default:return r.jsx("span",{children:"[不支持的消息类型]"},n)}}),mr=({data:e})=>r.jsxs("div",{className:"h-full flex flex-col overflow-hidden flex-1",children:[r.jsxs("div",{className:"flex gap-2 items-center flex-shrink-0",children:[r.jsxs("div",{className:"font-bold",children:[De(e)&&e.sender.card&&r.jsx("span",{className:"mr-1",children:e.sender.card}),r.jsx("span",{className:cr(De(e)&&e.sender.card&&"text-default-400 font-normal"),children:e.sender.nickname})]}),r.jsxs("div",{children:["(",e.sender.user_id,")"]}),r.jsxs("div",{className:"text-sm",children:["消息ID: ",e.message_id]})]}),r.jsxs(je,{showArrow:!0,triggerScaleOnOpen:!1,children:[r.jsx(Oe,{children:r.jsxs("div",{className:"flex-1 break-all overflow-hidden whitespace-pre-wrap border border-default-100 p-2 rounded-md hover:bg-content2 md:cursor-pointer transition-background relative group",children:[r.jsx("div",{className:"absolute right-2 top-2 opacity-0 group-hover:opacity-100 text-default-300",children:"点击查看完整消息"}),Array.isArray(e.message)?He(e.message,!0):e.raw_message]})}),r.jsx(xe,{children:r.jsx("div",{className:"p-2",children:Array.isArray(e.message)?He(e.message):e.raw_message})})]})]}),ft=({data:e})=>r.jsxs("div",{className:"h-full overflow-hidden flex flex-col w-full",children:[r.jsxs("div",{className:"flex items-center p-1 flex-shrink-0",children:[r.jsx(_e,{src:`https://p.qlogo.cn/gh/${e.group_id}/${e.group_id}/640/`,alt:"群头像",size:"sm",className:"flex-shrink-0 mr-2"}),r.jsxs("div",{children:["群 ",e.group_id]})]}),r.jsxs("div",{className:"flex items-start p-1 rounded-md h-full flex-1 border border-default-100",children:[r.jsx(_e,{src:`https://q1.qlogo.cn/g?b=qq&nk=${e.sender.user_id}&s=100`,alt:"用户头像",size:"md",className:"flex-shrink-0 mr-2"}),r.jsx(mr,{data:e})]})]}),vt=({data:e})=>r.jsxs("div",{className:"flex items-start p-2 rounded-md h-full flex-1",children:[r.jsx(_e,{src:`https://q1.qlogo.cn/g?b=qq&nk=${e.sender.user_id}&s=100`,alt:"用户头像",size:"md",className:"flex-shrink-0 mr-2"}),r.jsx(mr,{data:e})]}),Be=({data:e})=>e.message_type==="group"?r.jsx(ft,{data:e}):e.message_type==="private"?r.jsx(vt,{data:e}):r.jsx("div",{children:"未知消息类型"}),ht=({data:e})=>{const{group_id:t,user_id:a,file:n}=e;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["群号: ",t]}),r.jsxs("div",{children:["用户ID: ",a]}),r.jsxs("div",{children:["文件名: ",n.name]}),r.jsxs("div",{children:["文件大小: ",n.size," 字节"]})]})},mt=({data:e})=>{const{group_id:t,user_id:a,sub_type:n}=e;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["群号: ",t]}),r.jsxs("div",{children:["用户ID: ",a]}),r.jsxs("div",{children:["变动类型: ",n==="set"?"设置管理员":"取消管理员"]})]})},pt=({data:e})=>{const{group_id:t,operator_id:a,user_id:n,sub_type:i}=e;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["群号: ",t]}),r.jsxs("div",{children:["操作者ID: ",a]}),r.jsxs("div",{children:["用户ID: ",n]}),r.jsxs("div",{children:["原因: ",i]})]})},gt=({data:e})=>{const{group_id:t,operator_id:a,user_id:n,sub_type:i}=e;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["群号: ",t]}),r.jsxs("div",{children:["操作者ID: ",a]}),r.jsxs("div",{children:["用户ID: ",n]}),r.jsxs("div",{children:["增加类型: ",i]})]})},St=({data:e})=>{const{group_id:t,operator_id:a,user_id:n,sub_type:i,duration:v}=e;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["群号: ",t]}),r.jsxs("div",{children:["操作者ID: ",a]}),r.jsxs("div",{children:["用户ID: ",n]}),r.jsxs("div",{children:["禁言类型: ",i]}),r.jsxs("div",{children:["禁言时长: ",v," 秒"]})]})},_t=({data:e})=>{const{user_id:t}=e;return r.jsx(r.Fragment,{children:r.jsxs("div",{children:["用户ID: ",t]})})},yt=({data:e})=>{const{group_id:t,user_id:a,operator_id:n,message_id:i}=e;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["群号: ",t]}),r.jsxs("div",{children:["用户ID: ",a]}),r.jsxs("div",{children:["操作者ID: ",n]}),r.jsxs("div",{children:["消息ID: ",i]})]})},bt=({data:e})=>{const{user_id:t,message_id:a}=e;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["用户ID: ",t]}),r.jsxs("div",{children:["消息ID: ",a]})]})},jt=({data:e})=>{const{group_id:t,user_id:a,target_id:n}=e;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["群号: ",t]}),r.jsxs("div",{children:["用户ID: ",a]}),r.jsxs("div",{children:["目标ID: ",n]})]})},Ot=({data:e})=>{const{group_id:t,user_id:a,target_id:n}=e;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["群号: ",t]}),r.jsxs("div",{children:["用户ID: ",a]}),r.jsxs("div",{children:["目标ID: ",n]})]})},xt=({data:e})=>{const{group_id:t,user_id:a,honor_type:n}=e;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["群号: ",t]}),r.jsxs("div",{children:["用户ID: ",a]}),r.jsxs("div",{children:["荣誉类型: ",n]})]})},Et=({data:e})=>{const{group_id:t,user_id:a,message_id:n,likes:i}=e;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["群号: ",t]}),r.jsxs("div",{children:["用户ID: ",a]}),r.jsxs("div",{children:["消息ID: ",n]}),r.jsxs("div",{children:["表情回应:",i.map(v=>`表情ID: ${v.emoji_id}, 数量: ${v.count}`).join(", ")]})]})},It=({data:e})=>{const{group_id:t,message_id:a,sender_id:n,operator_id:i,sub_type:v}=e;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["群号: ",t]}),r.jsxs("div",{children:["消息ID: ",a]}),r.jsxs("div",{children:["发送者ID: ",n]}),r.jsxs("div",{children:["操作者ID: ",i]}),r.jsxs("div",{children:["操作类型: ",v]})]})},Nt=({data:e})=>{const{group_id:t,user_id:a,card_new:n,card_old:i}=e;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["群号: ",t]}),r.jsxs("div",{children:["用户ID: ",a]}),r.jsxs("div",{children:["新名片: ",n]}),r.jsxs("div",{children:["旧名片: ",i]})]})},wt=({data:e})=>{let t;switch(e.notice_type){case M.GroupUpload:t=r.jsx(ht,{data:e});break;case M.GroupAdmin:t=r.jsx(mt,{data:e});break;case M.GroupDecrease:t=r.jsx(pt,{data:e});break;case M.GroupIncrease:t=r.jsx(gt,{data:e});break;case M.GroupBan:t=r.jsx(St,{data:e});break;case M.FriendAdd:t=r.jsx(_t,{data:e});break;case M.GroupRecall:t=r.jsx(yt,{data:e});break;case M.FriendRecall:t=r.jsx(bt,{data:e});break;case M.Notify:switch(e.sub_type){case"poke":t=r.jsx(jt,{data:e});break;case"lucky_king":t=r.jsx(Ot,{data:e});break;case"honor":t=r.jsx(xt,{data:e});break}break;case M.GroupMsgEmojiLike:t=r.jsx(Et,{data:e});break;case M.GroupEssence:t=r.jsx(It,{data:e});break;case M.GroupCard:t=r.jsx(Nt,{data:e});break}return r.jsxs("div",{className:"flex gap-2 items-center",children:[r.jsx(W,{color:"warning",variant:"flat",children:"通知"}),r.jsx(W,{children:Cr(e.notice_type)}),t]})},Tt=({data:e})=>r.jsxs("div",{className:"flex gap-2 items-center",children:[r.jsx(W,{color:Rr(e.status),variant:"flat",children:Mr(e.status)}),e.data&&r.jsxs(je,{placement:"right",showArrow:!0,classNames:{content:"max-h-96 max-w-96 overflow-hidden p-0"},children:[r.jsx(Oe,{children:r.jsx(Y,{size:"sm",color:"primary",variant:"flat",radius:"full",className:"text-medium",children:"查看数据"})}),r.jsx(xe,{children:r.jsx(dr,{hideSymbol:!0,tooltipProps:{content:"点击复制"},classNames:{copyButton:"self-start sticky top-0 right-0"},className:"bg-content1 h-full overflow-y-scroll items-start",children:JSON.stringify(e.data,null,2).split(`
`).map((t,a)=>r.jsx("span",{className:"whitespace-pre-wrap break-all",children:t},a))})})]}),e.message&&r.jsxs(W,{className:"pl-0.5",variant:"flat",children:[r.jsx(W,{color:"warning",size:"sm",className:"-ml-2 mr-1",variant:"flat",children:"返回消息"}),e.message]})]}),kt={hidden:{opacity:0,scale:.8,y:50},visible:{opacity:1,scale:1,y:0,transition:{type:"spring",stiffness:300,damping:20}}};function Ct({data:e}){return r.jsx("div",{children:"Request消息，暂未适配"})}const Mt=e=>e==="meta_event"?100:e==="message"?180:e==="request"||e==="notice"?100:e==="message_sent"?250:100,Rt=e=>{if(le(e))switch(e.post_type){case"meta_event":return r.jsx(dt,{data:e});case"message":return r.jsx(Be,{data:e});case"request":return r.jsx(Ct,{data:e});case"notice":return r.jsx(wt,{data:e});case"message_sent":return r.jsx(Be,{data:e});default:return r.jsx("div",{children:"未知类型的消息"})}return r.jsx(Tt,{data:e})},Dt=({data:e,index:t,style:a})=>{const n=e[t],i=le(n);return r.jsx("div",{style:a,className:"p-1 overflow-visible w-full h-full",children:r.jsx(Ur.div,{variants:kt,initial:"hidden",animate:"visible",className:"h-full px-2",children:r.jsxs(lr,{className:"w-full h-full py-2 bg-opacity-50 backdrop-blur-sm",children:[r.jsxs(_r,{className:"py-0 text-default-500 flex-row gap-2",children:[r.jsx("div",{className:"font-bold",children:i?Dr(n.post_type):"请求响应"}),r.jsx("div",{className:"text-sm",children:i&&Wr(n.time)}),r.jsx("div",{className:"ml-auto",children:r.jsxs(je,{placement:"left",showArrow:!0,classNames:{content:"max-h-96 max-w-96 overflow-hidden p-0"},children:[r.jsx(Oe,{children:r.jsx(Y,{size:"sm",color:"primary",variant:"flat",radius:"full",isIconOnly:!0,className:"text-medium",children:r.jsx(Lr,{})})}),r.jsx(xe,{children:r.jsx(dr,{hideSymbol:!0,tooltipProps:{content:"点击复制"},classNames:{copyButton:"self-start sticky top-0 right-0"},className:"bg-content1 h-full overflow-y-scroll items-start",children:JSON.stringify(n,null,2).split(`
`).map((v,p)=>r.jsx("span",{className:"whitespace-pre-wrap break-all",children:v},p))})})]})})]}),r.jsx(ur,{className:"py-0",children:Rt(n)})]})})})},Pt=e=>{const{messages:t}=e,a=I.useRef(null),n=I.useRef(null),[i,v]=I.useState(400);return I.useEffect(()=>{const p=new ResizeObserver(()=>{a.current&&v(a.current.offsetHeight)});return a.current&&p.observe(a.current),()=>{p.disconnect()}},[]),I.useEffect(()=>{n.current&&n.current.resetAfterIndex(0,!0)},[t]),r.jsx("div",{className:"w-full h-full overflow-hidden",ref:a,children:r.jsx(ct,{ref:n,itemCount:t.length,width:"100%",style:{overflowX:"hidden"},itemSize:p=>{const g=t[p];return le(g)?Mt(g.post_type):100},height:i,itemData:t,itemKey:p=>t.length-p-1,children:Dt})})},At=e=>{const{sendMessage:t}=e,{isOpen:a,onOpen:n,onOpenChange:i}=yr(),v=I.useRef(null),p=I.useCallback(g=>{var S;const h=(S=v.current)==null?void 0:S.getValue();if(!h){X.error("消息不能为空");return}try{t(h),X.success("消息发送成功"),g()}catch{X.error("消息发送失败")}},[t]);return r.jsxs(r.Fragment,{children:[r.jsx(Y,{onPress:n,color:"primary",radius:"full",variant:"flat",children:"构造请求"}),r.jsx(br,{isOpen:a,onOpenChange:i,placement:"top-center",size:"5xl",scrollBehavior:"outside",isDismissable:!1,children:r.jsx(jr,{children:g=>r.jsxs(r.Fragment,{children:[r.jsx(Or,{className:"flex flex-col gap-1",children:"构造请求"}),r.jsx(xr,{children:r.jsx("div",{className:"h-96 dark:bg-[rgb(30,30,30)] p-2 rounded-md border border-default-100",children:r.jsx(qr,{height:"100%",defaultLanguage:"json",defaultValue:`{
  "action": "get_group_list"
}`,ref:v})})}),r.jsxs(Er,{children:[r.jsx(Pr,{}),r.jsx(Y,{color:"primary",variant:"flat",onPress:g,children:"取消"}),r.jsx(Y,{color:"primary",onPress:()=>p(g),children:"发送"})]})]})})})]})};var he={},T={},me={},$e;function R(){return $e||($e=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.isEventSourceSupported=e.isReactNative=e.ReadyState=e.DEFAULT_HEARTBEAT=e.UNPARSABLE_JSON_OBJECT=e.DEFAULT_RECONNECT_INTERVAL_MS=e.DEFAULT_RECONNECT_LIMIT=e.SOCKET_IO_PING_CODE=e.SOCKET_IO_PATH=e.SOCKET_IO_PING_INTERVAL=e.DEFAULT_EVENT_SOURCE_OPTIONS=e.EMPTY_EVENT_HANDLERS=e.DEFAULT_OPTIONS=void 0;var t=1,a=1e3*t;e.DEFAULT_OPTIONS={},e.EMPTY_EVENT_HANDLERS={},e.DEFAULT_EVENT_SOURCE_OPTIONS={withCredentials:!1,events:e.EMPTY_EVENT_HANDLERS},e.SOCKET_IO_PING_INTERVAL=25*a,e.SOCKET_IO_PATH="/socket.io/?EIO=3&transport=websocket",e.SOCKET_IO_PING_CODE="2",e.DEFAULT_RECONNECT_LIMIT=20,e.DEFAULT_RECONNECT_INTERVAL_MS=5e3,e.UNPARSABLE_JSON_OBJECT={},e.DEFAULT_HEARTBEAT={message:"ping",timeout:6e4,interval:25e3};var n;(function(v){v[v.UNINSTANTIATED=-1]="UNINSTANTIATED",v[v.CONNECTING=0]="CONNECTING",v[v.OPEN=1]="OPEN",v[v.CLOSING=2]="CLOSING",v[v.CLOSED=3]="CLOSED"})(n||(e.ReadyState=n={}));var i=function(){try{return"EventSource"in globalThis}catch{return!1}};e.isReactNative=typeof navigator<"u"&&navigator.product==="ReactNative",e.isEventSourceSupported=!e.isReactNative&&i()}(me)),me}var ne={},pe={},Je;function Ie(){return Je||(Je=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.resetWebSockets=e.sharedWebSockets=void 0,e.sharedWebSockets={};var t=function(a){if(a&&e.sharedWebSockets.hasOwnProperty(a))delete e.sharedWebSockets[a];else for(var n in e.sharedWebSockets)e.sharedWebSockets.hasOwnProperty(n)&&delete e.sharedWebSockets[n]};e.resetWebSockets=t}(pe)),pe}var H={},P={},Ve;function Ne(){if(Ve)return P;Ve=1,Object.defineProperty(P,"__esModule",{value:!0}),P.setUpSocketIOPing=P.appendQueryParams=P.parseSocketIOUrl=void 0;var e=R(),t=function(i){if(i){var v=/^https|wss/.test(i),p=i.replace(/^(https?|wss?)(:\/\/)?/,""),g=p.replace(/\/$/,""),h=v?"wss":"ws";return"".concat(h,"://").concat(g).concat(e.SOCKET_IO_PATH)}else if(i===""){var v=/^https/.test(window.location.protocol),h=v?"wss":"ws",S=window.location.port?":".concat(window.location.port):"";return"".concat(h,"://").concat(window.location.hostname).concat(S).concat(e.SOCKET_IO_PATH)}return i};P.parseSocketIOUrl=t;var a=function(i,v){v===void 0&&(v={});var p=/\?([\w]+=[\w]+)/,g=p.test(i),h="".concat(Object.entries(v).reduce(function(S,d){var u=d[0],m=d[1];return S+"".concat(u,"=").concat(m,"&")},"").slice(0,-1));return"".concat(i).concat(g?"&":"?").concat(h)};P.appendQueryParams=a;var n=function(i,v){v===void 0&&(v=e.SOCKET_IO_PING_INTERVAL);var p=function(){return i(e.SOCKET_IO_PING_CODE)};return window.setInterval(p,v)};return P.setUpSocketIOPing=n,P}var oe={},Ke;function pr(){if(Ke)return oe;Ke=1,Object.defineProperty(oe,"__esModule",{value:!0}),oe.heartbeat=a;var e=R();function t(n){return Array.isArray(n)?n.reduce(function(i,v){return i.current>v.current?i:v}).current:n.current}function a(n,i,v){var p=v||{},g=p.interval,h=g===void 0?e.DEFAULT_HEARTBEAT.interval:g,S=p.timeout,d=S===void 0?e.DEFAULT_HEARTBEAT.timeout:S,u=p.message,m=u===void 0?e.DEFAULT_HEARTBEAT.message:u,o=Math.max(100,h/10),c=Date.now(),s=setInterval(function(){var f=Date.now(),l=t(i);if(l+d<=f)console.warn("Heartbeat timed out, closing connection, last message received ".concat(f-l,"ms ago, last ping sent ").concat(f-c,"ms ago")),n.close();else if(l+h<=f&&c+h<=f)try{typeof m=="function"?n.send(m()):n.send(m),c=f}catch(_){console.error("Heartbeat failed, closing connection",_ instanceof Error?_.message:_),n.close()}},o);return n.addEventListener("close",function(){clearInterval(s)}),function(){}}return oe}var ae={},ge={},Qe;function we(){return Qe||(Qe=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.resetSubscribers=e.removeSubscriber=e.addSubscriber=e.hasSubscribers=e.getSubscribers=void 0;var t={},a=[],n=function(h){return(0,e.hasSubscribers)(h)?Array.from(t[h]):a};e.getSubscribers=n;var i=function(h){var S;return((S=t[h])===null||S===void 0?void 0:S.size)>0};e.hasSubscribers=i;var v=function(h,S){t[h]=t[h]||new Set,t[h].add(S)};e.addSubscriber=v;var p=function(h,S){t[h].delete(S)};e.removeSubscriber=p;var g=function(h){if(h&&t.hasOwnProperty(h))delete t[h];else for(var S in t)t.hasOwnProperty(S)&&delete t[S]};e.resetSubscribers=g}(ge)),ge}var Ye;function Te(){if(Ye)return ae;Ye=1,Object.defineProperty(ae,"__esModule",{value:!0}),ae.assertIsWebSocket=a,ae.resetGlobalState=n;var e=Ie(),t=we();function a(i,v){if(!v&&!(i instanceof WebSocket))throw new Error("")}function n(i){(0,t.resetSubscribers)(i),(0,e.resetWebSockets)(i)}return ae}var Xe;function Lt(){if(Xe)return H;Xe=1;var e=H&&H.__assign||function(){return e=Object.assign||function(d){for(var u,m=1,o=arguments.length;m<o;m++){u=arguments[m];for(var c in u)Object.prototype.hasOwnProperty.call(u,c)&&(d[c]=u[c])}return d},e.apply(this,arguments)};Object.defineProperty(H,"__esModule",{value:!0}),H.attachListeners=void 0;var t=Ne(),a=pr(),n=R(),i=Te(),v=function(d,u,m,o){d.onmessage=function(c){var s;u.current.onMessage&&u.current.onMessage(c),typeof(o==null?void 0:o.current)=="number"&&(o.current=Date.now()),!(typeof u.current.filter=="function"&&u.current.filter(c)!==!0)&&(u.current.heartbeat&&typeof u.current.heartbeat!="boolean"&&((s=u.current.heartbeat)===null||s===void 0?void 0:s.returnMessage)===c.data||m(c))}},p=function(d,u,m,o,c){d.onopen=function(s){if(u.current.onOpen&&u.current.onOpen(s),o.current=0,m(n.ReadyState.OPEN),u.current.heartbeat&&d instanceof WebSocket){var f=typeof u.current.heartbeat=="boolean"?void 0:u.current.heartbeat;c.current=Date.now(),(0,a.heartbeat)(d,c,f)}}},g=function(d,u,m,o,c){if(n.isEventSourceSupported&&d instanceof EventSource)return function(){};(0,i.assertIsWebSocket)(d,u.current.skipAssert);var s;return d.onclose=function(f){var l;if(u.current.onClose&&u.current.onClose(f),m(n.ReadyState.CLOSED),u.current.shouldReconnect&&u.current.shouldReconnect(f)){var _=(l=u.current.reconnectAttempts)!==null&&l!==void 0?l:n.DEFAULT_RECONNECT_LIMIT;if(c.current<_){var b=typeof u.current.reconnectInterval=="function"?u.current.reconnectInterval(c.current):u.current.reconnectInterval;s=window.setTimeout(function(){c.current++,o()},b??n.DEFAULT_RECONNECT_INTERVAL_MS)}else u.current.onReconnectStop&&u.current.onReconnectStop(_),console.warn("Max reconnect attempts of ".concat(_," exceeded"))}},function(){return s&&window.clearTimeout(s)}},h=function(d,u,m,o,c){var s;return d.onerror=function(f){var l;if(u.current.onError&&u.current.onError(f),n.isEventSourceSupported&&d instanceof EventSource&&(u.current.onClose&&u.current.onClose(e(e({},f),{code:1006,reason:"An error occurred with the EventSource: ".concat(f),wasClean:!1})),m(n.ReadyState.CLOSED),d.close()),u.current.retryOnError)if(c.current<((l=u.current.reconnectAttempts)!==null&&l!==void 0?l:n.DEFAULT_RECONNECT_LIMIT)){var _=typeof u.current.reconnectInterval=="function"?u.current.reconnectInterval(c.current):u.current.reconnectInterval;s=window.setTimeout(function(){c.current++,o()},_??n.DEFAULT_RECONNECT_INTERVAL_MS)}else u.current.onReconnectStop&&u.current.onReconnectStop(u.current.reconnectAttempts),console.warn("Max reconnect attempts of ".concat(u.current.reconnectAttempts," exceeded"))},function(){return s&&window.clearTimeout(s)}},S=function(d,u,m,o,c,s,f){var l=u.setLastMessage,_=u.setReadyState,b,x,y;return m.current.fromSocketIO&&(b=(0,t.setUpSocketIOPing)(f)),v(d,m,l,s),p(d,m,_,c,s),x=g(d,m,_,o,c),y=h(d,m,_,o,c),function(){_(n.ReadyState.CLOSING),x(),y(),d.close(),b&&clearInterval(b)}};return H.attachListeners=S,H}var B={},Ze;function Wt(){if(Ze)return B;Ze=1;var e=B&&B.__assign||function(){return e=Object.assign||function(u){for(var m,o=1,c=arguments.length;o<c;o++){m=arguments[o];for(var s in m)Object.prototype.hasOwnProperty.call(m,s)&&(u[s]=m[s])}return u},e.apply(this,arguments)};Object.defineProperty(B,"__esModule",{value:!0}),B.attachSharedListeners=void 0;var t=Ie(),a=R(),n=we(),i=Ne(),v=pr(),p=function(u,m,o){u.onmessage=function(c){(0,n.getSubscribers)(m).forEach(function(s){var f;s.optionsRef.current.onMessage&&s.optionsRef.current.onMessage(c),typeof((f=s==null?void 0:s.lastMessageTime)===null||f===void 0?void 0:f.current)=="number"&&(s.lastMessageTime.current=Date.now()),!(typeof s.optionsRef.current.filter=="function"&&s.optionsRef.current.filter(c)!==!0)&&(o&&typeof o!="boolean"&&(o==null?void 0:o.returnMessage)===c.data||s.setLastMessage(c))})}},g=function(u,m,o){u.onopen=function(c){var s=(0,n.getSubscribers)(m);s.forEach(function(f){f.reconnectCount.current=0,f.optionsRef.current.onOpen&&f.optionsRef.current.onOpen(c),f.setReadyState(a.ReadyState.OPEN),o&&u instanceof WebSocket&&(f.lastMessageTime.current=Date.now())}),o&&u instanceof WebSocket&&(0,v.heartbeat)(u,s.map(function(f){return f.lastMessageTime}),typeof o=="boolean"?void 0:o)}},h=function(u,m){u instanceof WebSocket&&(u.onclose=function(o){(0,n.getSubscribers)(m).forEach(function(c){c.optionsRef.current.onClose&&c.optionsRef.current.onClose(o),c.setReadyState(a.ReadyState.CLOSED)}),delete t.sharedWebSockets[m],(0,n.getSubscribers)(m).forEach(function(c){var s;if(c.optionsRef.current.shouldReconnect&&c.optionsRef.current.shouldReconnect(o)){var f=(s=c.optionsRef.current.reconnectAttempts)!==null&&s!==void 0?s:a.DEFAULT_RECONNECT_LIMIT;if(c.reconnectCount.current<f){var l=typeof c.optionsRef.current.reconnectInterval=="function"?c.optionsRef.current.reconnectInterval(c.reconnectCount.current):c.optionsRef.current.reconnectInterval;setTimeout(function(){c.reconnectCount.current++,c.reconnect.current()},l??a.DEFAULT_RECONNECT_INTERVAL_MS)}else c.optionsRef.current.onReconnectStop&&c.optionsRef.current.onReconnectStop(c.optionsRef.current.reconnectAttempts),console.warn("Max reconnect attempts of ".concat(f," exceeded"))}})})},S=function(u,m){u.onerror=function(o){(0,n.getSubscribers)(m).forEach(function(c){c.optionsRef.current.onError&&c.optionsRef.current.onError(o),a.isEventSourceSupported&&u instanceof EventSource&&(c.optionsRef.current.onClose&&c.optionsRef.current.onClose(e(e({},o),{code:1006,reason:"An error occurred with the EventSource: ".concat(o),wasClean:!1})),c.setReadyState(a.ReadyState.CLOSED))}),a.isEventSourceSupported&&u instanceof EventSource&&u.close()}},d=function(u,m,o,c){var s;return o.current.fromSocketIO&&(s=(0,i.setUpSocketIOPing)(c)),p(u,m,o.current.heartbeat),h(u,m),g(u,m,o.current.heartbeat),S(u,m),function(){s&&clearInterval(s)}};return B.attachSharedListeners=d,B}var er;function Ut(){if(er)return ne;er=1,Object.defineProperty(ne,"__esModule",{value:!0}),ne.createOrJoinSocket=void 0;var e=Ie(),t=R(),a=Lt(),n=Wt(),i=we(),v=function(g,h,S,d,u){return function(){if((0,i.removeSubscriber)(g,h),!(0,i.hasSubscribers)(g)){try{var m=e.sharedWebSockets[g];m instanceof WebSocket&&(m.onclose=function(o){S.current.onClose&&S.current.onClose(o),d(t.ReadyState.CLOSED)}),m.close()}catch{}u&&u(),delete e.sharedWebSockets[g]}}},p=function(g,h,S,d,u,m,o,c,s){if(!t.isEventSourceSupported&&d.current.eventSourceOptions)throw t.isReactNative?new Error("EventSource is not supported in ReactNative"):new Error("EventSource is not supported");if(d.current.share){var f=null;e.sharedWebSockets[h]===void 0?(e.sharedWebSockets[h]=d.current.eventSourceOptions?new EventSource(h,d.current.eventSourceOptions):new WebSocket(h,d.current.protocols),g.current=e.sharedWebSockets[h],S(t.ReadyState.CONNECTING),f=(0,n.attachSharedListeners)(e.sharedWebSockets[h],h,d,s)):(g.current=e.sharedWebSockets[h],S(e.sharedWebSockets[h].readyState));var l={setLastMessage:u,setReadyState:S,optionsRef:d,reconnectCount:o,lastMessageTime:c,reconnect:m};return(0,i.addSubscriber)(h,l),v(h,l,d,S,f)}else{if(g.current=d.current.eventSourceOptions?new EventSource(h,d.current.eventSourceOptions):new WebSocket(h,d.current.protocols),S(t.ReadyState.CONNECTING),!g.current)throw new Error("WebSocket failed to be created");return(0,a.attachListeners)(g.current,{setLastMessage:u,setReadyState:S},d,m.current,o,c,s)}};return ne.createOrJoinSocket=p,ne}var A={},rr;function qt(){return rr||(rr=1,function(e){var t=A&&A.__awaiter||function(h,S,d,u){function m(o){return o instanceof d?o:new d(function(c){c(o)})}return new(d||(d=Promise))(function(o,c){function s(_){try{l(u.next(_))}catch(b){c(b)}}function f(_){try{l(u.throw(_))}catch(b){c(b)}}function l(_){_.done?o(_.value):m(_.value).then(s,f)}l((u=u.apply(h,S||[])).next())})},a=A&&A.__generator||function(h,S){var d={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},u,m,o,c=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return c.next=s(0),c.throw=s(1),c.return=s(2),typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function s(l){return function(_){return f([l,_])}}function f(l){if(u)throw new TypeError("Generator is already executing.");for(;c&&(c=0,l[0]&&(d=0)),d;)try{if(u=1,m&&(o=l[0]&2?m.return:l[0]?m.throw||((o=m.return)&&o.call(m),0):m.next)&&!(o=o.call(m,l[1])).done)return o;switch(m=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return d.label++,{value:l[1],done:!1};case 5:d.label++,m=l[1],l=[0];continue;case 7:l=d.ops.pop(),d.trys.pop();continue;default:if(o=d.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){d=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){d.label=l[1];break}if(l[0]===6&&d.label<o[1]){d.label=o[1],o=l;break}if(o&&d.label<o[2]){d.label=o[2],d.ops.push(l);break}o[2]&&d.ops.pop(),d.trys.pop();continue}l=S.call(h,d)}catch(_){l=[6,_],m=0}finally{u=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},n=A&&A.__spreadArray||function(h,S,d){if(d||arguments.length===2)for(var u=0,m=S.length,o;u<m;u++)(o||!(u in S))&&(o||(o=Array.prototype.slice.call(S,0,u)),o[u]=S[u]);return h.concat(o||Array.prototype.slice.call(S))};Object.defineProperty(e,"__esModule",{value:!0}),e.getUrl=void 0;var i=Ne(),v=R(),p=function(h){return new Promise(function(S){return window.setTimeout(S,h)})},g=function(h,S){for(var d=[],u=2;u<arguments.length;u++)d[u-2]=arguments[u];return t(void 0,n([h,S],d,!0),void 0,function(m,o,c){var s,f,l,_,b,x,y,j;return c===void 0&&(c=0),a(this,function(O){switch(O.label){case 0:if(typeof m!="function")return[3,10];O.label=1;case 1:return O.trys.push([1,3,,9]),[4,m()];case 2:return s=O.sent(),[3,9];case 3:return O.sent(),o.current.retryOnError?(f=(x=o.current.reconnectAttempts)!==null&&x!==void 0?x:v.DEFAULT_RECONNECT_LIMIT,c<f?(l=typeof o.current.reconnectInterval=="function"?o.current.reconnectInterval(c):o.current.reconnectInterval,[4,p(l??v.DEFAULT_RECONNECT_INTERVAL_MS)]):[3,5]):[3,7];case 4:return O.sent(),[2,(0,e.getUrl)(m,o,c+1)];case 5:return(j=(y=o.current).onReconnectStop)===null||j===void 0||j.call(y,c),[2,null];case 6:return[3,8];case 7:return[2,null];case 8:return[3,9];case 9:return[3,11];case 10:s=m,O.label=11;case 11:return _=o.current.fromSocketIO?(0,i.parseSocketIOUrl)(s):s,b=o.current.queryParams?(0,i.appendQueryParams)(_,o.current.queryParams):_,[2,b]}})})};e.getUrl=g}(A)),A}var Se={},tr;function Ft(){return tr||(tr=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.websocketWrapper=void 0;var t=function(a,n){return new Proxy(a,{get:function(i,v){var p=i[v];return v==="reconnect"?n:typeof p=="function"?(console.error("Calling methods directly on the websocket is not supported at this moment. You must use the methods returned by useWebSocket."),function(){}):p},set:function(i,v,p){return/^on/.test(v)?(console.warn("The websocket's event handlers should be defined through the options object passed into useWebSocket."),!1):(i[v]=p,!0)}})};e.websocketWrapper=t,e.default=e.websocketWrapper}(Se)),Se}var nr;function ke(){if(nr)return T;nr=1;var e=T&&T.__assign||function(){return e=Object.assign||function(m){for(var o,c=1,s=arguments.length;c<s;c++){o=arguments[c];for(var f in o)Object.prototype.hasOwnProperty.call(o,f)&&(m[f]=o[f])}return m},e.apply(this,arguments)},t=T&&T.__awaiter||function(m,o,c,s){function f(l){return l instanceof c?l:new c(function(_){_(l)})}return new(c||(c=Promise))(function(l,_){function b(j){try{y(s.next(j))}catch(O){_(O)}}function x(j){try{y(s.throw(j))}catch(O){_(O)}}function y(j){j.done?l(j.value):f(j.value).then(b,x)}y((s=s.apply(m,o||[])).next())})},a=T&&T.__generator||function(m,o){var c={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},s,f,l,_=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return _.next=b(0),_.throw=b(1),_.return=b(2),typeof Symbol=="function"&&(_[Symbol.iterator]=function(){return this}),_;function b(y){return function(j){return x([y,j])}}function x(y){if(s)throw new TypeError("Generator is already executing.");for(;_&&(_=0,y[0]&&(c=0)),c;)try{if(s=1,f&&(l=y[0]&2?f.return:y[0]?f.throw||((l=f.return)&&l.call(f),0):f.next)&&!(l=l.call(f,y[1])).done)return l;switch(f=0,l&&(y=[y[0]&2,l.value]),y[0]){case 0:case 1:l=y;break;case 4:return c.label++,{value:y[1],done:!1};case 5:c.label++,f=y[1],y=[0];continue;case 7:y=c.ops.pop(),c.trys.pop();continue;default:if(l=c.trys,!(l=l.length>0&&l[l.length-1])&&(y[0]===6||y[0]===2)){c=0;continue}if(y[0]===3&&(!l||y[1]>l[0]&&y[1]<l[3])){c.label=y[1];break}if(y[0]===6&&c.label<l[1]){c.label=l[1],l=y;break}if(l&&c.label<l[2]){c.label=l[2],c.ops.push(y);break}l[2]&&c.ops.pop(),c.trys.pop();continue}y=o.call(m,c)}catch(j){y=[6,j],f=0}finally{s=l=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}},n=T&&T.__importDefault||function(m){return m&&m.__esModule?m:{default:m}};Object.defineProperty(T,"__esModule",{value:!0}),T.useWebSocket=void 0;var i=Ee(),v=Fr(),p=R(),g=Ut(),h=qt(),S=n(Ft()),d=Te(),u=function(m,o,c){o===void 0&&(o=p.DEFAULT_OPTIONS),c===void 0&&(c=!0);var s=(0,i.useState)(null),f=s[0],l=s[1],_=(0,i.useState)({}),b=_[0],x=_[1],y=(0,i.useMemo)(function(){if(!o.disableJson&&f)try{return JSON.parse(f.data)}catch{return p.UNPARSABLE_JSON_OBJECT}return null},[f,o.disableJson]),j=(0,i.useRef)(null),O=(0,i.useRef)(null),w=(0,i.useRef)(function(){}),k=(0,i.useRef)(0),J=(0,i.useRef)(Date.now()),z=(0,i.useRef)([]),D=(0,i.useRef)(null),U=(0,i.useRef)(o);U.current=o;var Z=j.current&&b[j.current]!==void 0?b[j.current]:m!==null&&c===!0?p.ReadyState.CONNECTING:p.ReadyState.UNINSTANTIATED,ue=o.queryParams?JSON.stringify(o.queryParams):null,q=(0,i.useCallback)(function(E,N){var F;if(N===void 0&&(N=!0),p.isEventSourceSupported&&O.current instanceof EventSource){console.warn("Unable to send a message from an eventSource");return}((F=O.current)===null||F===void 0?void 0:F.readyState)===p.ReadyState.OPEN?((0,d.assertIsWebSocket)(O.current,U.current.skipAssert),O.current.send(E)):N&&z.current.push(E)},[]),se=(0,i.useCallback)(function(E,N){N===void 0&&(N=!0),q(JSON.stringify(E),N)},[q]),ee=(0,i.useCallback)(function(){return U.current.share!==!0||p.isEventSourceSupported&&O.current instanceof EventSource?O.current:(D.current===null&&O.current&&((0,d.assertIsWebSocket)(O.current,U.current.skipAssert),D.current=(0,S.default)(O.current,w)),D.current)},[]);return(0,i.useEffect)(function(){if(m!==null&&c===!0){var E,N=!1,F=!0,ie=function(){return t(void 0,void 0,void 0,function(){var G,C,re;return a(this,function(Ce){switch(Ce.label){case 0:return G=j,[4,(0,h.getUrl)(m,U)];case 1:return G.current=Ce.sent(),j.current===null?(console.error("Failed to get a valid URL. WebSocket connection aborted."),j.current="ABORTED",(0,v.flushSync)(function(){return x(function(te){return e(e({},te),{ABORTED:p.ReadyState.CLOSED})})}),[2]):(C=function(te){N||(0,v.flushSync)(function(){return l(te)})},re=function(te){N||(0,v.flushSync)(function(){return x(function(gr){var de;return e(e({},gr),j.current&&(de={},de[j.current]=te,de))})})},F&&(E=(0,g.createOrJoinSocket)(O,j.current,re,U,C,w,k,J,q)),[2])}})})};return w.current=function(){N||(D.current&&(D.current=null),E==null||E(),ie())},ie(),function(){N=!0,F=!1,D.current&&(D.current=null),E==null||E(),l(null)}}else(m===null||c===!1)&&(k.current=0,x(function(G){var C;return e(e({},G),j.current&&(C={},C[j.current]=p.ReadyState.CLOSED,C))}))},[m,c,ue,q]),(0,i.useEffect)(function(){Z===p.ReadyState.OPEN&&z.current.splice(0).forEach(function(E){q(E)})},[Z]),{sendMessage:q,sendJsonMessage:se,lastMessage:f,lastJsonMessage:y,readyState:Z,getWebSocket:ee}};return T.useWebSocket=u,T}var $={},ar;function zt(){if(ar)return $;ar=1;var e=$&&$.__assign||function(){return e=Object.assign||function(g){for(var h,S=1,d=arguments.length;S<d;S++){h=arguments[S];for(var u in h)Object.prototype.hasOwnProperty.call(h,u)&&(g[u]=h[u])}return g},e.apply(this,arguments)};Object.defineProperty($,"__esModule",{value:!0}),$.useSocketIO=void 0;var t=Ee(),a=ke(),n=R(),i={type:"empty",payload:null},v=function(g){if(!g||!g.data)return i;var h=g.data.match(/\[.*]/);if(!h)return i;var S=JSON.parse(h);return!Array.isArray(S)||!S[1]?i:{type:S[0],payload:S[1]}},p=function(g,h,S){h===void 0&&(h=n.DEFAULT_OPTIONS),S===void 0&&(S=!0);var d=(0,t.useMemo)(function(){return e(e({},h),{fromSocketIO:!0})},[]),u=(0,a.useWebSocket)(g,d,S),m=u.sendMessage,o=u.sendJsonMessage,c=u.lastMessage,s=u.readyState,f=u.getWebSocket,l=(0,t.useMemo)(function(){return v(c)},[c]);return{sendMessage:m,sendJsonMessage:o,lastMessage:l,lastJsonMessage:l,readyState:s,getWebSocket:f}};return $.useSocketIO=p,$}var L={},sr;function Gt(){if(sr)return L;sr=1;var e=L&&L.__assign||function(){return e=Object.assign||function(p){for(var g,h=1,S=arguments.length;h<S;h++){g=arguments[h];for(var d in g)Object.prototype.hasOwnProperty.call(g,d)&&(p[d]=g[d])}return p},e.apply(this,arguments)},t=L&&L.__rest||function(p,g){var h={};for(var S in p)Object.prototype.hasOwnProperty.call(p,S)&&g.indexOf(S)<0&&(h[S]=p[S]);if(p!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,S=Object.getOwnPropertySymbols(p);d<S.length;d++)g.indexOf(S[d])<0&&Object.prototype.propertyIsEnumerable.call(p,S[d])&&(h[S[d]]=p[S[d]]);return h};Object.defineProperty(L,"__esModule",{value:!0}),L.useEventSource=void 0;var a=Ee(),n=ke(),i=R(),v=function(p,g,h){g===void 0&&(g=i.DEFAULT_EVENT_SOURCE_OPTIONS);var S=g.withCredentials,d=g.events,u=t(g,["withCredentials","events"]);h===void 0&&(h=!0);var m=e(e({},u),{eventSourceOptions:{withCredentials:S}}),o=(0,a.useRef)(i.EMPTY_EVENT_HANDLERS);d&&(o.current=d);var c=(0,n.useWebSocket)(p,m,h),s=c.lastMessage,f=c.readyState,l=c.getWebSocket;return(0,a.useEffect)(function(){s!=null&&s.type&&Object.entries(o.current).forEach(function(_){var b=_[0],x=_[1];b===s.type&&x(s)})},[s]),{lastEvent:s,readyState:f,getEventSource:l}};return L.useEventSource=v,L}var ir;function Ht(){return ir||(ir=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.resetGlobalState=e.useEventSource=e.ReadyState=e.useSocketIO=e.default=void 0;var t=ke();Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.useWebSocket}});var a=zt();Object.defineProperty(e,"useSocketIO",{enumerable:!0,get:function(){return a.useSocketIO}});var n=R();Object.defineProperty(e,"ReadyState",{enumerable:!0,get:function(){return n.ReadyState}});var i=Gt();Object.defineProperty(e,"useEventSource",{enumerable:!0,get:function(){return i.useEventSource}});var v=Te();Object.defineProperty(e,"resetGlobalState",{enumerable:!0,get:function(){return v.resetGlobalState}})}(he)),he}var Q=Ht();const Bt=fr(Q);function ce({title:e,color:t}){const a=`text-${t} text-sm`,n=`bg-${t}`;return r.jsxs("div",{className:"flex flex-col justify-center items-center gap-1 rounded-md px-2 col-span-2 md:col-span-1",children:[r.jsx("div",{className:cr("w-4 h-4 rounded-full",n)}),r.jsx("div",{className:a,children:e})]})}function $t({state:e}){return e===Q.ReadyState.OPEN?r.jsx(ce,{title:"已连接",color:"success"}):e===Q.ReadyState.CLOSED?r.jsx(ce,{title:"已关闭",color:"primary"}):e===Q.ReadyState.CONNECTING?r.jsx(ce,{title:"连接中",color:"warning"}):e===Q.ReadyState.CLOSING?r.jsx(ce,{title:"关闭中",color:"warning"}):null}const or=[{label:"元事件",value:"meta_event"},{label:"消息",value:"message"},{label:"请求",value:"request"},{label:"通知",value:"notice"},{label:"消息发送",value:"message_sent"}],Jt=e=>{const{filterTypes:t,onSelectionChange:a}=e;return r.jsx(Br,{selectedKeys:t,onSelectionChange:n=>{n!=="all"&&(n==null?void 0:n.size)===0&&(n="all"),a(n)},label:"筛选消息类型",selectionMode:"multiple",items:or,renderValue:n=>n.length===or.length?"全部":n.map(i=>{var v;return(v=i.data)==null?void 0:v.label}).join(","),children:n=>r.jsx($r,{value:n.value,children:n.label},n.value)})},Vt=(e,t)=>r.jsx(Jt,{filterTypes:e,onSelectionChange:t});function Kt(e,t){const a=Kr([]),[n,i]=I.useState("all"),v=a.filter(d=>{if(n==="all"||n.size===0)return!0;if(le(d))return n.has(d.post_type);if(Ar(d))return n.has("request")}),{sendMessage:p,readyState:g}=Bt(e,{onMessage:I.useCallback(d=>{try{const u=JSON.parse(d.data);a.unshift(u)}catch{X.error("WebSocket 消息解析失败")}},[]),queryParams:{access_token:t},onError:d=>{X.error("WebSocket 连接失败"),console.error("WebSocket error:",d)},onOpen:()=>{a.splice(0,a.length)}}),h=d=>{if(g!==Q.ReadyState.OPEN)throw new Error("WebSocket 连接未建立");p(d)},S=Vt(n,i);return{sendMessage:h,readyState:g,messageHistory:a,filteredMessages:v,filterTypes:n,setFilterTypes:i,FilterMessagesType:S}}function kn(){const e=new URL(window.location.origin);e.port="3001",e.protocol="ws:";const t=e.href,[a,n]=Ir(Nr.wsDebugConfig,{url:t,token:""}),[i,v]=I.useState(a.url),[p,g]=I.useState(a.token),{sendMessage:h,readyState:S,FilterMessagesType:d,filteredMessages:u}=Kt(a.url,a.token),m=I.useCallback(()=>{if(!i.startsWith("ws://")&&!i.startsWith("wss://")){X.error("WebSocket URL 不合法");return}n({url:i,token:p})},[i,p]);return r.jsxs(r.Fragment,{children:[r.jsx("title",{children:"Websocket调试 - NapCat WebUI"}),r.jsxs("div",{className:"h-[calc(100vh-4rem)] overflow-hidden flex flex-col",children:[r.jsx(lr,{className:"mx-2 mt-2 flex-shrink-0 bg-opacity-50 backdrop-blur-sm",children:r.jsxs(ur,{className:"gap-2",children:[r.jsxs("div",{className:"grid gap-2 items-center md:grid-cols-5",children:[r.jsx(Re,{className:"col-span-2",label:"WebSocket URL",type:"text",value:i,onChange:o=>v(o.target.value),placeholder:"输入 WebSocket URL"}),r.jsx(Re,{className:"col-span-2",label:"Token",type:"text",value:p,onChange:o=>g(o.target.value),placeholder:"输入 Token"}),r.jsx("div",{className:"flex-shrink-0 flex gap-2 col-span-2 md:col-span-1",children:r.jsx(Y,{color:"primary",onPress:m,size:"lg",radius:"full",className:"w-full md:w-auto",children:"连接"})})]}),r.jsx("div",{className:"p-2 border border-default-100 bg-content1 bg-opacity-50 rounded-md dark:bg-[rgb(30,30,30)]",children:r.jsxs("div",{className:"grid gap-2 md:grid-cols-5 items-center md:w-fit",children:[r.jsx($t,{state:S}),r.jsx("div",{className:"md:w-64 max-w-full col-span-2",children:d}),r.jsx(At,{sendMessage:h})]})})]})}),r.jsx("div",{className:"flex-1 overflow-hidden",children:r.jsx(Pt,{messages:u})})]})]})}export{kn as default};
