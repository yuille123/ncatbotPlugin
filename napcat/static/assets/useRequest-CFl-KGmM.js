import{f as b,g as y,h as w,e as fe,b as be,r as ye,a as Re,_ as Te,i as we,j as le,u as Ee}from"./index-CYXW7ZCx.js";import{r as g}from"./react-router-dom-BuK5Vxqh.js";import{g as de}from"./react-dom-DoC2WAmd.js";var Pe=function(r){return function(e,n){var t=g.useRef(!1);r(function(){return function(){t.current=!1}},[]),r(function(){if(!t.current)t.current=!0;else return e()},n)}},xe=function(r){return typeof r=="function"};function A(r){var e=g.useRef(r);e.current=g.useMemo(function(){return r},[r]);var n=g.useRef();return n.current||(n.current=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return e.current.apply(this,t)}),n.current}const J=Pe(g.useEffect);var ve=function(r,e){var n=e.manual,t=e.ready,i=t===void 0?!0:t,o=e.defaultParams,c=o===void 0?[]:o,l=e.refreshDeps,a=l===void 0?[]:l,u=e.refreshDepsAction,v=g.useRef(!1);return v.current=!1,J(function(){!n&&i&&(v.current=!0,r.run.apply(r,b([],y(c),!1)))},[i]),J(function(){v.current||n||(v.current=!0,u?u():r.refresh())},b([],y(a),!1)),{onBefore:function(){if(!i)return{stopNow:!0}}}};ve.onInit=function(r){var e=r.ready,n=e===void 0?!0:e,t=r.manual;return{loading:!t&&n}};function me(r){var e=g.useRef(r);return e.current=r,e}var K=function(r){var e=me(r);g.useEffect(function(){return function(){e.current()}},[])},F=new Map,Ce=function(r,e,n){var t=F.get(r);t!=null&&t.timer&&clearTimeout(t.timer);var i=void 0;e>-1&&(i=setTimeout(function(){F.delete(r)},e)),F.set(r,w(w({},n),{timer:i}))},Oe=function(r){return F.get(r)},L=new Map,Se=function(r){return L.get(r)},_e=function(r,e){L.set(r,e),e.then(function(n){return L.delete(r),n}).catch(function(){L.delete(r)})},C={},Ae=function(r,e){C[r]&&C[r].forEach(function(n){return n(e)})},B=function(r,e){return C[r]||(C[r]=[]),C[r].push(e),function(){var t=C[r].indexOf(e);C[r].splice(t,1)}},je=function(r,e){var n=e.cacheKey,t=e.cacheTime,i=t===void 0?5*60*1e3:t,o=e.staleTime,c=o===void 0?0:o,l=e.setCache,a=e.getCache,u=g.useRef(),v=g.useRef(),s=function(d,f){l?l(f):Ce(d,i,f),Ae(d,f.data)},m=function(d,f){return f===void 0&&(f=[]),a?a(f):Oe(d)};return fe(function(){if(n){var d=m(n);d&&Object.hasOwnProperty.call(d,"data")&&(r.state.data=d.data,r.state.params=d.params,(c===-1||new Date().getTime()-d.time<=c)&&(r.state.loading=!1)),u.current=B(n,function(f){r.setState({data:f})})}},[]),K(function(){var d;(d=u.current)===null||d===void 0||d.call(u)}),n?{onBefore:function(d){var f=m(n,d);return!f||!Object.hasOwnProperty.call(f,"data")?{}:c===-1||new Date().getTime()-f.time<=c?{loading:!1,data:f==null?void 0:f.data,error:void 0,returnNow:!0}:{data:f==null?void 0:f.data,error:void 0}},onRequest:function(d,f){var h=Se(n);return h&&h!==v.current?{servicePromise:h}:(h=d.apply(void 0,b([],y(f),!1)),v.current=h,_e(n,h),{servicePromise:h})},onSuccess:function(d,f){var h;n&&((h=u.current)===null||h===void 0||h.call(u),s(n,{data:d,params:f,time:new Date().getTime()}),u.current=B(n,function(R){r.setState({data:R})}))},onMutate:function(d){var f;n&&((f=u.current)===null||f===void 0||f.call(u),s(n,{data:d,params:r.state.params,time:new Date().getTime()}),u.current=B(n,function(h){r.setState({data:h})}))}}:{}},H,re;function Q(){if(re)return H;re=1;function r(e){var n=typeof e;return e!=null&&(n=="object"||n=="function")}return H=r,H}var $,ne;function qe(){if(ne)return $;ne=1;var r=be(),e=function(){return r.Date.now()};return $=e,$}var U,te;function Ne(){if(te)return U;te=1;var r=/\s/;function e(n){for(var t=n.length;t--&&r.test(n.charAt(t)););return t}return U=e,U}var G,ie;function We(){if(ie)return G;ie=1;var r=Ne(),e=/^\s+/;function n(t){return t&&t.slice(0,r(t)+1).replace(e,"")}return G=n,G}var z,ue;function De(){if(ue)return z;ue=1;var r=ye(),e=Re(),n="[object Symbol]";function t(i){return typeof i=="symbol"||e(i)&&r(i)==n}return z=t,z}var X,ae;function Fe(){if(ae)return X;ae=1;var r=We(),e=Q(),n=De(),t=NaN,i=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt;function a(u){if(typeof u=="number")return u;if(n(u))return t;if(e(u)){var v=typeof u.valueOf=="function"?u.valueOf():u;u=e(v)?v+"":v}if(typeof u!="string")return u===0?u:+u;u=r(u);var s=o.test(u);return s||c.test(u)?l(u.slice(2),s?2:8):i.test(u)?t:+u}return X=a,X}var V,oe;function he(){if(oe)return V;oe=1;var r=Q(),e=qe(),n=Fe(),t="Expected a function",i=Math.max,o=Math.min;function c(l,a,u){var v,s,m,d,f,h,R=0,O=!1,E=!1,x=!0;if(typeof l!="function")throw new TypeError(t);a=n(a)||0,r(u)&&(O=!!u.leading,E="maxWait"in u,m=E?i(n(u.maxWait)||0,a):m,x="trailing"in u?!!u.trailing:x);function S(p){var P=v,q=s;return v=s=void 0,R=p,d=l.apply(q,P),d}function j(p){return R=p,f=setTimeout(T,a),O?S(p):d}function D(p){var P=p-h,q=p-R,ee=a-P;return E?o(ee,m-q):ee}function _(p){var P=p-h,q=p-R;return h===void 0||P>=a||P<0||E&&q>=m}function T(){var p=e();if(_(p))return Z(p);f=setTimeout(T,D(p))}function Z(p){return f=void 0,x&&v?S(p):(v=s=void 0,d)}function ge(){f!==void 0&&clearTimeout(f),R=0,v=h=s=f=void 0}function pe(){return f===void 0?d:Z(e())}function I(){var p=e(),P=_(p);if(v=arguments,s=this,h=p,P){if(f===void 0)return j(h);if(E)return clearTimeout(f),f=setTimeout(T,a),S(h)}return f===void 0&&(f=setTimeout(T,a)),d}return I.cancel=ge,I.flush=pe,I}return V=c,V}var Le=he();const Me=de(Le);var Ie=function(r,e){var n=e.debounceWait,t=e.debounceLeading,i=e.debounceTrailing,o=e.debounceMaxWait,c=g.useRef(),l=g.useMemo(function(){var a={};return t!==void 0&&(a.leading=t),i!==void 0&&(a.trailing=i),o!==void 0&&(a.maxWait=o),a},[t,i,o]);return g.useEffect(function(){if(n){var a=r.runAsync.bind(r);return c.current=Me(function(u){u()},n,l),r.runAsync=function(){for(var u=[],v=0;v<arguments.length;v++)u[v]=arguments[v];return new Promise(function(s,m){var d;(d=c.current)===null||d===void 0||d.call(c,function(){a.apply(void 0,b([],y(u),!1)).then(s).catch(m)})})},function(){var u;(u=c.current)===null||u===void 0||u.cancel(),r.runAsync=a}}},[n,l]),n?{onCancel:function(){var a;(a=c.current)===null||a===void 0||a.cancel()}}:{}},Be=function(r,e){var n=e.loadingDelay,t=e.ready,i=g.useRef();if(!n)return{};var o=function(){i.current&&clearTimeout(i.current)};return{onBefore:function(){return o(),t!==!1&&(i.current=setTimeout(function(){r.setState({loading:!0})},n)),{loading:!1}},onFinally:function(){o()},onCancel:function(){o()}}},M=!!(typeof window<"u"&&window.document&&window.document.createElement);function Y(){return M?document.visibilityState!=="hidden":!0}var N=[];function He(r){return N.push(r),function(){var n=N.indexOf(r);N.splice(n,1)}}if(M){var $e=function(){if(Y())for(var r=0;r<N.length;r++){var e=N[r];e()}};window.addEventListener("visibilitychange",$e,!1)}var Ue=function(r,e){var n=e.pollingInterval,t=e.pollingWhenHidden,i=t===void 0?!0:t,o=e.pollingErrorRetryCount,c=o===void 0?-1:o,l=g.useRef(),a=g.useRef(),u=g.useRef(0),v=function(){var s;l.current&&clearTimeout(l.current),(s=a.current)===null||s===void 0||s.call(a)};return J(function(){n||v()},[n]),n?{onBefore:function(){v()},onError:function(){u.current+=1},onSuccess:function(){u.current=0},onFinally:function(){c===-1||c!==-1&&u.current<=c?l.current=setTimeout(function(){!i&&!Y()?a.current=He(function(){r.refresh()}):r.refresh()},n):u.current=0},onCancel:function(){v()}}:{}};function Ge(r,e){var n=!1;return function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];n||(n=!0,r.apply(void 0,b([],y(t),!1)),setTimeout(function(){n=!1},e))}}function ze(){return M&&typeof navigator.onLine<"u"?navigator.onLine:!0}var W=[];function Xe(r){return W.push(r),function(){var n=W.indexOf(r);n>-1&&W.splice(n,1)}}if(M){var se=function(){if(!(!Y()||!ze()))for(var r=0;r<W.length;r++){var e=W[r];e()}};window.addEventListener("visibilitychange",se,!1),window.addEventListener("focus",se,!1)}var Ve=function(r,e){var n=e.refreshOnWindowFocus,t=e.focusTimespan,i=t===void 0?5e3:t,o=g.useRef(),c=function(){var l;(l=o.current)===null||l===void 0||l.call(o)};return g.useEffect(function(){if(n){var l=Ge(r.refresh.bind(r),i);o.current=Xe(function(){l()})}return function(){c()}},[n,i]),K(function(){c()}),{}},ke=function(r,e){var n=e.retryInterval,t=e.retryCount,i=g.useRef(),o=g.useRef(0),c=g.useRef(!1);return t?{onBefore:function(){c.current||(o.current=0),c.current=!1,i.current&&clearTimeout(i.current)},onSuccess:function(){o.current=0},onError:function(){if(o.current+=1,t===-1||o.current<=t){var l=n??Math.min(1e3*Math.pow(2,o.current),3e4);i.current=setTimeout(function(){c.current=!0,r.refresh()},l)}else o.current=0},onCancel:function(){o.current=0,i.current&&clearTimeout(i.current)}}:{}},k,ce;function Je(){if(ce)return k;ce=1;var r=he(),e=Q(),n="Expected a function";function t(i,o,c){var l=!0,a=!0;if(typeof i!="function")throw new TypeError(n);return e(c)&&(l="leading"in c?!!c.leading:l,a="trailing"in c?!!c.trailing:a),r(i,o,{leading:l,maxWait:o,trailing:a})}return k=t,k}var Ke=Je();const Qe=de(Ke);var Ye=function(r,e){var n=e.throttleWait,t=e.throttleLeading,i=e.throttleTrailing,o=g.useRef(),c={};return t!==void 0&&(c.leading=t),i!==void 0&&(c.trailing=i),g.useEffect(function(){if(n){var l=r.runAsync.bind(r);return o.current=Qe(function(a){a()},n,c),r.runAsync=function(){for(var a=[],u=0;u<arguments.length;u++)a[u]=arguments[u];return new Promise(function(v,s){var m;(m=o.current)===null||m===void 0||m.call(o,function(){l.apply(void 0,b([],y(a),!1)).then(v).catch(s)})})},function(){var a;r.runAsync=l,(a=o.current)===null||a===void 0||a.cancel()}}},[n,t,i]),n?{onCancel:function(){var l;(l=o.current)===null||l===void 0||l.cancel()}}:{}},Ze=function(r){g.useEffect(function(){r==null||r()},[])},er=function(){function r(e,n,t,i){i===void 0&&(i={}),this.serviceRef=e,this.options=n,this.subscribe=t,this.initState=i,this.count=0,this.state={loading:!1,params:void 0,data:void 0,error:void 0},this.state=w(w(w({},this.state),{loading:!n.manual}),i)}return r.prototype.setState=function(e){e===void 0&&(e={}),this.state=w(w({},this.state),e),this.subscribe()},r.prototype.runPluginHandler=function(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];var i=this.pluginImpls.map(function(o){var c;return(c=o[e])===null||c===void 0?void 0:c.call.apply(c,b([o],y(n),!1))}).filter(Boolean);return Object.assign.apply(Object,b([{}],y(i),!1))},r.prototype.runAsync=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Te(this,void 0,void 0,function(){var t,i,o,c,l,a,u,v,s,m,d,f,h,R,O,E,x,S,j,D,_;return we(this,function(T){switch(T.label){case 0:if(this.count+=1,t=this.count,i=this.runPluginHandler("onBefore",e),o=i.stopNow,c=o===void 0?!1:o,l=i.returnNow,a=l===void 0?!1:l,u=le(i,["stopNow","returnNow"]),c)return[2,new Promise(function(){})];if(this.setState(w({loading:!0,params:e},u)),a)return[2,Promise.resolve(u.data)];(h=(f=this.options).onBefore)===null||h===void 0||h.call(f,e),T.label=1;case 1:return T.trys.push([1,3,,4]),v=this.runPluginHandler("onRequest",this.serviceRef.current,e).servicePromise,v||(v=(d=this.serviceRef).current.apply(d,b([],y(e),!1))),[4,v];case 2:return s=T.sent(),t!==this.count?[2,new Promise(function(){})]:(this.setState({data:s,error:void 0,loading:!1}),(O=(R=this.options).onSuccess)===null||O===void 0||O.call(R,s,e),this.runPluginHandler("onSuccess",s,e),(x=(E=this.options).onFinally)===null||x===void 0||x.call(E,e,s,void 0),t===this.count&&this.runPluginHandler("onFinally",e,s,void 0),[2,s]);case 3:if(m=T.sent(),t!==this.count)return[2,new Promise(function(){})];throw this.setState({error:m,loading:!1}),(j=(S=this.options).onError)===null||j===void 0||j.call(S,m,e),this.runPluginHandler("onError",m,e),(_=(D=this.options).onFinally)===null||_===void 0||_.call(D,e,void 0,m),t===this.count&&this.runPluginHandler("onFinally",e,void 0,m),m;case 4:return[2]}})})},r.prototype.run=function(){for(var e=this,n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];this.runAsync.apply(this,b([],y(n),!1)).catch(function(i){e.options.onError||console.error(i)})},r.prototype.cancel=function(){this.count+=1,this.setState({loading:!1}),this.runPluginHandler("onCancel")},r.prototype.refresh=function(){this.run.apply(this,b([],y(this.state.params||[]),!1))},r.prototype.refreshAsync=function(){return this.runAsync.apply(this,b([],y(this.state.params||[]),!1))},r.prototype.mutate=function(e){var n=xe(e)?e(this.state.data):e;this.runPluginHandler("onMutate",n),this.setState({data:n})},r}();function rr(r,e,n){e===void 0&&(e={}),n===void 0&&(n=[]);var t=e.manual,i=t===void 0?!1:t,o=e.ready,c=o===void 0?!0:o,l=le(e,["manual","ready"]),a=w({manual:i,ready:c},l),u=me(r),v=Ee(),s=fe(function(){var m=n.map(function(d){var f;return(f=d==null?void 0:d.onInit)===null||f===void 0?void 0:f.call(d,a)}).filter(Boolean);return new er(u,a,v,Object.assign.apply(Object,b([{}],y(m),!1)))},[]);return s.options=a,s.pluginImpls=n.map(function(m){return m(s,a)}),Ze(function(){if(!i&&c){var m=s.state.params||e.defaultParams||[];s.run.apply(s,b([],y(m),!1))}}),K(function(){s.cancel()}),{loading:s.state.loading,data:s.state.data,error:s.state.error,params:s.state.params||[],cancel:A(s.cancel.bind(s)),refresh:A(s.refresh.bind(s)),refreshAsync:A(s.refreshAsync.bind(s)),run:A(s.run.bind(s)),runAsync:A(s.runAsync.bind(s)),mutate:A(s.mutate.bind(s))}}function ur(r,e,n){return rr(r,e,b(b([],y([]),!1),[Ie,Be,Ue,Ve,Ye,ve,je,ke],!1))}export{De as a,Q as r,ur as u};
